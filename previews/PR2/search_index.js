var documenterSearchIndex = {"docs":
[{"location":"methods/#Methods-list","page":"Methods","title":"Methods list","text":"","category":"section"},{"location":"methods/","page":"Methods","title":"Methods","text":"","category":"page"},{"location":"methods/#Methods-usage","page":"Methods","title":"Methods usage","text":"","category":"section"},{"location":"methods/","page":"Methods","title":"Methods","text":"Modules = [ScoreMatching]","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"EditURL = \"https://github.com/JeffFessler/ScoreMatching.jl/blob/main/docs/lit/examples/docs/lit/examples/01-overview.jl\"","category":"page"},{"location":"generated/examples/01-overview/#overview","page":"Score Matching overview","title":"Score Matching overview","text":"","category":"section"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"This page introduces the Julia package ScoreMatching.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"This page was generated from a single Julia file: 01-overview.jl.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"In any such Julia documentation, you can access the source code using the \"Edit on GitHub\" link in the top right.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"The corresponding notebook can be viewed in nbviewer here: 01-overview.ipynb, and opened in binder here: 01-overview.ipynb.","category":"page"},{"location":"generated/examples/01-overview/#Setup","page":"Score Matching overview","title":"Setup","text":"","category":"section"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Packages needed here.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"using ScoreMatching\nusing MIRTjim: jim, prompt\nusing Distributions: Distribution, Gamma, Normal, MixtureModel, logpdf, pdf\nimport Distributions: logpdf, pdf\nimport ForwardDiff\nusing LinearAlgebra: tr\nusing LaTeXStrings\nusing Random: seed!; seed!(0)\nusing Optim: optimize, BFGS, Fminbox\nimport Optim: minimizer\nusing Plots: plot, plot!, scatter, default, gui\nusing InteractiveUtils: versioninfo\ndefault(label=\"\", markerstrokecolor=:auto)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"The following line is helpful when running this file as a script; this way it will prompt user to hit a key after each figure is displayed.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"isinteractive() ? jim(:prompt, true) : prompt(:draw);\nnothing #hide","category":"page"},{"location":"generated/examples/01-overview/#Overview","page":"Score Matching overview","title":"Overview","text":"","category":"section"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Given T IID training data samples mathbfx_1  mathbfx_T  mathbbR^N, we often want to find the parameters mathbfθ of a model distribution p(mathbfx mathbfθ) that \"best fit\" the data.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Maximum-likelihood estimation is impractical for complicated models where the normalizing constant is intractable.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Hyvärinen 2005 proposed an alternative called score matching that circumvents needing to find the normalizing constant.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"The idea behind the score matching approach to model fitting is","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"hatmathbfθ = arg min_mathbfθ\nJ(mathbfθ)\nqquad\nJ(mathbfθ) =\nfrac1T _t=1^T\n mathbfs(mathbfx_t mathbfθ) - mathbfs(mathbfx_t) ^2","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"where mathbfs(mathbfx mathbfθ) = nabla_mathbfx log p(mathbfx mathbfθ) is the score function of the model distribution, and mathbfs(mathbfx) = nabla_mathbfx log p(mathbfx) is the score function of the (typically unknown) data distribution.","category":"page"},{"location":"generated/examples/01-overview/#Illustration","page":"Score Matching overview","title":"Illustration","text":"","category":"section"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"For didactic purposes, we illustrate this basic version of score matching by fitting samples from a Gamma distribution to a mixture of gaussians.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Some convenience methods","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"logpdf(d::Distribution) = x -> logpdf(d, x)\npdf(d::Distribution) = x -> pdf(d, x)\nderivative(f::Function) = x -> ForwardDiff.derivative(f, x)\ngradient(f::Function) = x -> ForwardDiff.gradient(f, x)\nscore(d::Distribution) = derivative(logpdf(d))\nscore_deriv(d::Distribution) = derivative(score(d)) # scalar x only","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Generate training data","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"T = 100\ndata_dis = Gamma(8, 1.0)\ndata_score = derivative(logpdf(data_dis))\ndata = rand(data_dis, T)\npd = scatter(data, zeros(T))","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"To perform unconstrained minimization of a D-component mixture, the following mapping from mathbbR^D-1 to the D-dimensional simplex is helpful. It is the inverse of the additive logratio transform.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"function map_r_s(y::AbstractVector)\n    p = exp.([y; 0])\n    return p / sum(p)\nend\nmap_r_s(y::Real...) = map_r_s([y...])\n\ny1 = range(-1,1,101) * 9\ny2 = range(-1,1,101) * 9\ntmp = map_r_s.(y1, y2')\njim(y1, y2, tmp; title=\"Simplex parameterization\", nrow=1)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Define model distribution","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"nmix = 3 # how many gaussians in the mixture model\nfunction model(θ ; σmin::Real=1e-2)\n    mu = θ[1:nmix]\n    sig = θ[nmix .+ (1:nmix)]\n    any(<(σmin), sig) && throw(\"bad σ\")\n    # sig = σmin .+ exp.(sig) # ensure σ > 0\n    p = map_r_s(θ[2nmix .+ (1:(nmix-1))])\n    tmp = [(μ,σ) for (μ,σ) in zip(mu, sig)]\n    return MixtureModel(Normal, tmp, p)\nend;\nnothing #hide","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Define score-matching cost function","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"function cost_sm2(x::AbstractVector{<:Real}, θ)\n    model_score = score(model(θ))\n    return sum(abs2, model_score.(x) - data_score.(x)) / T\nend;\nnothing #hide","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Minimize this score-matching cost function:","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"cost_sm1 = (θ) -> cost_sm2(data, θ);\nnothing #hide","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Initial crude guess of mixture model parameters","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"θ0 = [5, 7, 9, 1.5, 1.5, 1.5, 0, 0];\nnothing #hide","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Plot data pdf and initial model pdf","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"pf = plot(pdf(data_dis); xlims = (-1, 25), label=\"Gamma pdf\",\n    color = :black,\n    xlabel = L\"x\",\n    ylabel = L\"p(x) \\ \\mathrm{ and } \\ p(x;θ)\",\n)\nplot!(pf, pdf(model(θ0)), label = \"Initial Gaussian mixture\", color=:blue)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"prompt()","category":"page"},{"location":"generated/examples/01-overview/#Impractical-score-matching","page":"Score Matching overview","title":"Impractical score matching","text":"","category":"section"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"lower = [fill(0, nmix); fill(1.0, nmix); fill(-Inf, nmix-1)]\nupper = [fill(Inf, nmix); fill(Inf, nmix); fill(Inf, nmix-1)]\nopt_sm = optimize(cost_sm1, lower, upper, θ0, Fminbox(BFGS()); autodiff = :forward)\nθsm = minimizer(opt_sm)\n\nplot!(pf, pdf(model(θsm)), label = \"SM Gaussian mixture\", color=:red)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"prompt()","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Plot the data score and model score functions to see how well they match. The largest mismatch is in the tails of the distribution where there are few (if any) data points.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"ps = plot(data_score; xlims=(1,20), label = \"Data score function\",\n    xticks=[1,20], xlabel=L\"x\", color=:black)\nplot!(ps, score(model(θsm)); label = \"SM score function\", color=:red)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"prompt()","category":"page"},{"location":"generated/examples/01-overview/#Maximum-likelihood-estimation","page":"Score Matching overview","title":"Maximum-likelihood estimation","text":"","category":"section"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"This toy example is simple enough that we can apply ML estimation to it directly. In fact, ML estimation is a seemingly more practical optimization problem than score matching in this case.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"As expected, ML estimation leads to a lower negative log-likelihood.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"negloglike(θ) = (-1/T) * sum(logpdf(model(θ)), data)\nopt_ml = optimize(negloglike, lower, upper, θsm, Fminbox(BFGS()); autodiff = :forward)\nθml = minimizer(opt_ml)\nnegloglike.([θml, θsm, θ0])","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Curiously, ML estimation here leads to much worse fits to the pdf than score matching, even though we initialized the ML optimizer with the score-matching parameters. Perhaps the landscape of the log-likelihood is less well-behaved than that of the SM cost.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"plot!(pf, pdf(model(θml)), label = \"ML Gaussian mixture\", color=:magenta)\nplot!(ps, score(model(θml)), label = \"ML score function\", color=:magenta)\nplot(pf, ps)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"prompt()","category":"page"},{"location":"generated/examples/01-overview/#Practical-score-matching","page":"Score Matching overview","title":"Practical score matching","text":"","category":"section"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"The above SM fitting process used score(data_dis), the score-function of the data distribution, which is unknown in practical situations.","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Hyvärinen 2005 derived the following more practical cost function that is independent of the unknown data score function:","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"J(mathbfθ) =\nfrac1T _t=1^T\n_i=1^N _i s_i(mathbfx_t mathbfθ)\n + frac12  s_i(mathbfx_t mathbfθ) ^2","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"ignoring a constant that is independent of θ where","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"_i s_i(mathbfx mathbfθ)\n=\nfrac x_i s_i(mathbfx mathbfθ)\n=\nfrac^2 x_i^2 log p(mathbfx mathbfθ)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"(For large models this version is still a bit impractical because it depends on the diagonal elements of the Hessian of the log prior. Subsequent pages deal with that issue.)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Practical score-matching cost function","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"function cost_sp2(x::AbstractVector{<:Real}, θ)\n    tmp = model(θ)\n    model_score = score(tmp)\n    return (1/T) * (sum(score_deriv(tmp), x) +\n        0.5 * sum(abs2 ∘ model_score, x))\nend;\n\ncost_sp1 = (θ) -> cost_sp2(data, θ) # minimize this score-matching cost function\nopt_sp = optimize(cost_sp1, lower, upper, θ0, Fminbox(BFGS()); autodiff = :forward)\nθsp = minimizer(opt_sp)\ncost_sp1.([θsp, θsm, θml])","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"plot!(pf, pdf(model(θsp)), label = \"SP Gaussian mixture\", color=:cyan)\nplot!(ps, score(model(θsp)), label = \"SP score function\", color=:cyan)\npfs = plot(pf, ps)","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"Curiously the supposedly equivalent SM cost function works much worse. Like the ML estimate, the first two σ values are stuck at the lower limit. Could it be local extrema? More investigation is needed!","category":"page"},{"location":"generated/examples/01-overview/#Reproducibility","page":"Score Matching overview","title":"Reproducibility","text":"","category":"section"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"This page was generated with the following version of Julia:","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"io = IOBuffer(); versioninfo(io); split(String(take!(io)), '\\n')","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"And with the following package versions","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"import Pkg; Pkg.status()","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"","category":"page"},{"location":"generated/examples/01-overview/","page":"Score Matching overview","title":"Score Matching overview","text":"This page was generated using Literate.jl.","category":"page"},{"location":"","page":"Home","title":"Home","text":"CurrentModule = ScoreMatching","category":"page"},{"location":"#ScoreMatching.jl-Documentation","page":"Home","title":"ScoreMatching.jl Documentation","text":"","category":"section"},{"location":"#Overview","page":"Home","title":"Overview","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"This Julia package ScoreMatching provides tools for fitting statistical distributions to training data.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Here, \"score\" means the gradient of a log-likelihood nabla_mathbfx log p(mathbfx mathbftheta) as defined  by Hyvärinen 2005.","category":"page"},{"location":"","page":"Home","title":"Home","text":"See the \"Examples\" for details.","category":"page"}]
}
